<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¡œì»¬ ë®¤ì§ í”Œë ˆì´ì–´</title>
    <style>
        /* OlgaKoplikì˜ ë””ìì¸ ê°ì„±ì„ ë°˜ì˜í•œ ìŠ¤íƒ€ì¼ */
        :root {
            --primary: #ff5e5e;
            --bg: #1e1e26;
            --card: #2d2d37;
            --text: #ffffff;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .player-card {
            background: var(--card);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            width: 350px;
            text-align: center;
        }

        .album-art {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff5e5e, #ff99ac);
            margin: 0 auto 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 20px rgba(255, 94, 94, 0.4);
            animation: rotate 10s linear infinite;
            animation-play-state: paused;
        }

        .album-art.playing { animation-play-state: running; }

        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .info h2 { margin: 10px 0 5px; font-size: 1.2rem; }
        .info p { color: #888; font-size: 0.9rem; margin-bottom: 20px; }

        /* prakhar625 ìŠ¤íƒ€ì¼ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ */
        .controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 20px;
        }

        button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.5rem;
            transition: 0.3s;
        }

        button:hover { color: var(--primary); }

        #playBtn {
            width: 60px;
            height: 60px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ì¬ìƒ ëª©ë¡ ìŠ¤íƒ€ì¼ */
        .playlist-container {
            margin-top: 20px;
            max-height: 150px;
            overflow-y: auto;
            text-align: left;
            border-top: 1px solid #444;
            padding-top: 10px;
        }

        .playlist-item {
            padding: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            border-radius: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .playlist-item:hover { background: rgba(255,255,255,0.1); }

        input[type="file"] { margin-bottom: 15px; width: 100%; font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="player-card">
    <div class="album-art" id="disk">ğŸµ</div>
    
    <div class="info">
        <h2 id="title">ìŒì•…ì„ ì¶”ê°€í•˜ì„¸ìš”</h2>
        <p id="artist">Local Storage Player</p>
    </div>

    <input type="file" id="fileInput" multiple accept="audio/*" webkitdirectory>

    <div class="controls">
        <button id="prevBtn">â®</button>
        <button id="playBtn">â–¶</button>
        <button id="nextBtn">â­</button>
    </div>

    <div class="playlist-container" id="playlist">
        </div>
</div>

<audio id="mainAudio"></audio>

<script>
    const audio = document.getElementById('mainAudio');
    const playBtn = document.getElementById('playBtn');
    const disk = document.getElementById('disk');
    const fileInput = document.getElementById('fileInput');
    const playlistArea = document.getElementById('playlist');
    const title = document.getElementById('title');

    let db;
    let currentSongs = [];
    let currentIndex = 0;

    // 1. IndexedDB ì´ˆê¸°í™” (ì˜êµ¬ ì €ì¥ì†Œ)
    const request = indexedDB.open("MusicPlayerDB", 1);
    request.onupgradeneeded = (e) => {
        db = e.target.result;
        db.createObjectStore("songs", { keyPath: "name" });
    };
    request.onsuccess = (e) => {
        db = e.target.result;
        refreshPlaylist();
    };

    // 2. íŒŒì¼ ì„ íƒ ë° ì €ì¥ ë¡œì§
    fileInput.onchange = async (e) => {
        const files = Array.from(e.target.files);
        const transaction = db.transaction(["songs"], "readwrite");
        const store = transaction.objectStore("songs");

        for (const file of files) {
            if (file.type.startsWith('audio/')) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    store.put({ name: file.name, data: ev.target.result });
                    if (file === files[files.length - 1]) setTimeout(refreshPlaylist, 500);
                };
                reader.readAsArrayBuffer(file);
            }
        }
    };

    // 3. í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ê°±ì‹  (ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°)
    function refreshPlaylist() {
        const transaction = db.transaction(["songs"], "readonly");
        const store = transaction.objectStore("songs");
        const getAll = store.getAll();

        getAll.onsuccess = () => {
            currentSongs = getAll.result;
            playlistArea.innerHTML = '';
            currentSongs.forEach((song, index) => {
                const div = document.createElement('div');
                div.className = 'playlist-item';
                div.innerText = song.name;
                div.onclick = () => playSong(index);
                playlistArea.appendChild(div);
            });
        };
    }

    // 4. ì¬ìƒ ë¡œì§ (prakhar625 ìŠ¤íƒ€ì¼ ì»¨íŠ¸ë¡¤)
    function playSong(index) {
        if (currentSongs.length === 0) return;
        currentIndex = index;
        const song = currentSongs[currentIndex];
        
        const blob = new Blob([song.data], { type: 'audio/mp3' });
        const url = URL.createObjectURL(blob);
        
        audio.src = url;
        audio.play();
        
        title.innerText = song.name;
        playBtn.innerText = 'â¸';
        disk.classList.add('playing');
    }

    playBtn.onclick = () => {
        if (audio.paused) {
            audio.play();
            playBtn.innerText = 'â¸';
            disk.classList.add('playing');
        } else {
            audio.pause();
            playBtn.innerText = 'â–¶';
            disk.classList.remove('playing');
        }
    };

    document.getElementById('nextBtn').onclick = () => {
        currentIndex = (currentIndex + 1) % currentSongs.length;
        playSong(currentIndex);
    };

    document.getElementById('prevBtn').onclick = () => {
        currentIndex = (currentIndex - 1 + currentSongs.length) % currentSongs.length;
        playSong(currentIndex);
    };

    // ìë™ ë‹¤ìŒê³¡ ì¬ìƒ
    audio.onended = () => document.getElementById('nextBtn').click();

</script>

</body>
</html>
